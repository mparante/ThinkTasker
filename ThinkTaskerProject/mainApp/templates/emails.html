{% extends "base_generic.html" %}

{% block title %}Extracted Emails{% endblock %}

{% block content %}
  <h2 class="mb-4">Extracted Emails</h2>
  <form action="{% url 'sync-emails' %}" method="post" style="margin-bottom: 1em;">
    {% csrf_token %}
    <button type="submit" class="btn btn-primary">Sync from Outlook</button>
  </form>
  <div class="board">
    {% if processed_emails %}
      {% for email in processed_emails %}
        <a href="{{ email.web_link }}" target="_blank" style="text-decoration: none; color: inherit;">
          <div class="task-card mb-4 p-4 shadow-sm rounded transition" style="background: #fff; position: relative; cursor: pointer;">
            <h4 class="mb-2">{{ email.subject }}</h4>
            <div class="mb-2 text-secondary small">
              <strong>Processed:</strong>
              <span>{{ email.processed_at|date:"M d, Y H:i" }}</span>
            </div>
            <div class="email-preview mb-2" style="color: #555;">
              {{ email.body_preview|truncatechars:120|default_if_none:"" }}
              <!-- {% if email.tasks.all %}
                <div style="margin-top: 5px; color: #357;">
                  <b>Actionable Task(s):</b>
                  <ul style="margin:0 0 0 15px; padding:0;">
                    {% for task in email.tasks.all %}
                      <li>{{ task.task_description|truncatechars:120|default_if_none:"" }}</li>
                    {% endfor %}
                  </ul>
                </div>
              {% endif %} -->
            </div>
          </div>
        </a>
      {% endfor %}
    {% else %}
      <p>No processed emails yet. Click "Sync" to fetch from Outlook.</p>
    {% endif %}
  </div>
{% endblock %}
